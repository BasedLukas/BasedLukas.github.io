<!DOCTYPE html><html lang="en"><!-- Head tag --><head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">



    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- Bootstrap -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!--Tiny bird analytics-->

    <!-- background image -->
    <!-- <link rel="preload" href="/null" as="image" fetchpriority="high"> -->

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"> 
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- Gallery -->
    <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/> -->


    <!--Description-->
    

    
        <meta name="description" content="A collection of projects, essays and thoughts">
        <meta property="og:description" content="A collection of projects, essays and thoughts">
        <meta name="twitter:description" content="A collection of projects, essays and thoughts">
    

    <!--Author-->
    
        <meta name="author" content="Lukas">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="WASM">
        <meta name="twitter:title" content="WASM">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Lukas's Writings">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
        <meta name="twitter:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
    

        <meta name="twitter:card" content="summary_large_image">

    

    
        <meta name="twitter:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
    

    <!-- Title -->
    
    <title>WASM - Lukas's Writings</title>

    <!-- favicon -->
    
        <link rel="icon" href="/img/favicon.ico">
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="Lukas's Writings" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-custom navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Home</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/links">
                            
                                Links
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image:url(/null)">
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-1">
                <div class="post-heading">
                    <h1>WASM</h1>
                    
                    <h2 class="post-subheading">
                        It's so over for JavaScript
                    </h2>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Lukas on
                        
                        
                            2024-12-06
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-md-10 col-md-offset-1 col-lg-offset-1 col-lg-10">
                

 <style>#robot-frame{display:none}#mobile-message{text-align:center;color:red;margin-top:50px;font-size:1.5em;font-weight:700;display:none}@media screen and (orientation:landscape) and (max-width:768px){#robot-frame{display:block}#mobile-message{display:none}}@media screen and (min-width:769px){#robot-frame{display:block}#mobile-message{display:none}}</style>
 
 <!-- The iframe -->
 <iframe id="robot-frame" src="robot.html" style="border:none;width:100%;height:850px"></iframe>

 <!-- Message for mobile portrait mode -->
 <div id="mobile-message">
     The game cannot load in portrait mode. <br> 
     Please turn your phone sideways or visit on a desktop device.
 </div>

<script>function handleOrientationChange(){const e=document.getElementById("robot-frame"),n=document.getElementById("mobile-message");window.innerWidth<769?window.matchMedia("(orientation: landscape)").matches?(e.style.display="block",n.style.display="none"):(e.style.display="none",n.style.display="block"):(e.style.display="block",n.style.display="none")}handleOrientationChange(),window.addEventListener("resize",handleOrientationChange);
</script>



<p><em>Note: This puzzle is based on a <a href="https://loreley.one/2023-07-cpu/">previous blog post </a> of mine. I’ve reprinted it below (with slight modifications) to provide the context of how this CPU works and why I made it. The functionality of the CPU is derived entirely from simulated logic gates. All the operations and control flow are based on the underlying properties of the logic gates, and changing their operation leads to corresponding changes in function.</em><br><em>I’ve been playing around with WASM (Web Assembly) and decided to resuscitate my old python code from that blogpost in order to run it in the browser. The entire python interpreter is bundled with the game code using WASM in the browser. I thought this was pretty cool.</em><br><em>Thanks to Ivan for reviewing an earlier version of this post.</em></p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#tutorial" aria-expanded="false" aria-controls="collapse">
Tutorial
</button>

<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#old-cpu-post" aria-expanded="false" aria-controls="collapse">
Old Blog Post
</button>


<div class="collapse" id="tutorial">

<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>This CPU features six general-purpose registers (<code>reg0</code> to <code>reg5</code>), along with a special register (<code>reg6</code>) used for both input and output. It supports four main types of operations:</p>
<ul>
<li><strong>Immediate Values</strong></li>
<li><strong>Arithmetic Operations</strong></li>
<li><strong>Copying</strong></li>
<li><strong>Comparisons and Control Flow</strong></li>
</ul>
<p>All values in the CPU are 8-bit and overflow after 255 to 0.<br>For comparisons, values are treated as <strong>signed</strong> (range -128 to 127).</p>
<hr>
<h3 id="Immediate-Values"><a href="#Immediate-Values" class="headerlink" title="Immediate Values"></a>Immediate Values</h3><p>Load a constant value into <code>reg0</code>. Only values up to 63 are allowed because the two most significant bits (MSB) are reserved for instruction encoding.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">0       # Load 0 into reg0 (min allowed immediate)</span><br><span class="line">36      # Load 36 into reg0</span><br><span class="line">63      # Load 63 into reg0 (max allowed immediate)</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Copying-Data"><a href="#Copying-Data" class="headerlink" title="Copying Data"></a>Copying Data</h3><p>The <code>copy</code> instruction copies data between registers or between a register and the input/output.<br><strong>Input and Output</strong>: <code>reg6</code> serves as both the input and output register.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">copy &lt;source_register&gt; &lt;destination_register&gt;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">copy 6 1   # Copy value from input (reg6) to reg1</span><br><span class="line">copy 3 6   # Copy value from reg3 to output (reg6)</span><br><span class="line">copy 5 3   # Copy value from reg5 into reg3</span><br><span class="line">copy 6 6   # Copy from input directly to output</span><br><span class="line">copy 1 1   # NOP</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Arithmetic-and-Logical-Operations"><a href="#Arithmetic-and-Logical-Operations" class="headerlink" title="Arithmetic and Logical Operations"></a>Arithmetic and Logical Operations</h3><p>Arithmetic and logical operations use <code>reg1</code> and <code>reg2</code> as operands and store the result in <code>reg3</code>.<br>Arithmetic uses 2’s complliment. Values overflow if they exceed 255. </p>
<p><strong>Addition</strong> (<code>add</code>): Adds <code>reg1</code> and <code>reg2</code>.<br><strong>Subtraction</strong> (<code>sub</code>): Subtracts <code>reg2</code> from <code>reg1</code>.<br><strong>Bitwise AND</strong> (<code>and</code>): Performs a bitwise AND operation on <code>reg1</code> and <code>reg2</code>.<br><strong>Bitwise OR</strong> (<code>or</code>): Performs a bitwise OR operation on <code>reg1</code> and <code>reg2</code>.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1        # Load 1 into reg0</span><br><span class="line">copy 0 1 # Move 1 into reg1</span><br><span class="line">2        # Load 2 into reg0</span><br><span class="line">copy 0 2 # Move 2 into reg2</span><br><span class="line">add      # reg3 = reg1 + reg2 = 1 + 2 = 3</span><br><span class="line">copy 3 6 # Output result (3)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">32</span><br><span class="line">copy 0 1</span><br><span class="line">32</span><br><span class="line">copy 0 2</span><br><span class="line">add  # 64 in reg 3</span><br><span class="line">copy 3 2</span><br><span class="line">copy 3 1</span><br><span class="line">add # 128 in reg 3</span><br><span class="line">copy 3 1</span><br><span class="line">copy 3 2</span><br><span class="line">add </span><br><span class="line">copy 3 6</span><br><span class="line"># total 256, so output is 0 == [0,0,0,0,0,0,0,0]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">0</span><br><span class="line">copy 0 1</span><br><span class="line">2</span><br><span class="line">copy 0 2</span><br><span class="line">sub  # 0 - 2 = -2</span><br><span class="line">copy 3 6</span><br><span class="line"># cpu output is -2 == [1,1,1,1,1,1,1,0]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">32</span><br><span class="line">copy 0 1</span><br><span class="line">32</span><br><span class="line">copy 0 2</span><br><span class="line">add  # 64 in reg 3</span><br><span class="line">copy 3 2</span><br><span class="line">copy 3 1</span><br><span class="line">add # 128 in reg 3</span><br><span class="line">1</span><br><span class="line">copy 0 2</span><br><span class="line">copy 3 1</span><br><span class="line">sub     # 128 - 1</span><br><span class="line">copy 3 6</span><br><span class="line"># result is 127 == [0,1,1,1,1,1,1,1] in 2's compliment</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Comparisons-and-Control-Flow"><a href="#Comparisons-and-Control-Flow" class="headerlink" title="Comparisons and Control Flow"></a>Comparisons and Control Flow</h3><p>The <code>eval</code> instruction compares the <strong>signed</strong> value in <code>reg3</code> against <code>0</code>. If the condition is true, the program counter jumps to the address in <code>reg0</code>.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">eval &lt;condition&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Supported conditions:</p>
<ul>
<li><code>eval always</code>: Always jump.</li>
<li><code>eval never</code>: Never jump.</li>
<li><code>eval =</code>: Jump if <code>reg3 == 0</code>.</li>
<li><code>eval !=</code>: Jump if <code>reg3 != 0</code>.</li>
<li><code>eval &lt;</code>: Jump if <code>reg3 &lt; 0</code> (signed).</li>
<li><code>eval &lt;=</code>: Jump if <code>reg3 &lt;= 0</code> (signed).</li>
<li><code>eval &gt;</code>: Jump if <code>reg3 &gt; 0</code> (signed).</li>
<li><code>eval &gt;=</code>: Jump if <code>reg3 &gt;= 0</code> (signed).</li>
</ul>
<hr>
<h3 id="Labels"><a href="#Labels" class="headerlink" title="Labels"></a>Labels</h3><p>Labels act as named locations in the program. Defining a label associates it with its position in the program. Calling labels is just shorthand for using immediate values (and thus labels can’t be placed after line 63).</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">label &lt;name&gt;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">label start # start = 0</span><br><span class="line">copy 6 1    # Read input into reg1</span><br><span class="line">add         # Add reg1 and reg2</span><br><span class="line">start       # Label used here as jump target, equvalent to using immediate 0</span><br><span class="line">eval &gt;=     # Jump to "start" if reg3 &gt;= 0</span><br></pre></td></tr></tbody></table></figure>

<p>This program copies <code>1</code> into <code>reg1</code>, adds it with <code>reg2</code>, and stores the result in <code>reg2</code> in a loop until the result overflows and becomes negative.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1           # Load 1 into reg0</span><br><span class="line">copy 0 1    # Copy 1 into reg1</span><br><span class="line">label loop</span><br><span class="line">add         # reg3 = reg1 + reg2</span><br><span class="line">copy 3 2    # Store result in reg2</span><br><span class="line">copy 3 6    # print result to output</span><br><span class="line">loop</span><br><span class="line">eval &gt;=     # Jump to label loop if reg3 &gt;= 0</span><br></pre></td></tr></tbody></table></figure>

<p><strong>For comparisons, the value is treated as signed (<code>127</code> is interpreted as <code>127</code>, but <code>128</code> is interpreted as <code>-128</code>). The last result the cpu prints is thus <code>128</code></strong></p>
<h3 id="Robot-Instructions"><a href="#Robot-Instructions" class="headerlink" title="Robot Instructions"></a>Robot Instructions</h3><p>output (controls):<br><code>1 == turn left</code><br><code>2 == turn right</code><br><code>3 == step forward</code></p>
<p>input:<br><code>1 == wall</code><br><code>0 == clear</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># this will rotate you left</span><br><span class="line">1</span><br><span class="line">copy 0 6</span><br><span class="line"></span><br><span class="line"># rotate right 3 times</span><br><span class="line">2</span><br><span class="line">copy 0 6</span><br><span class="line">copy 0 6</span><br><span class="line">copy 0 6</span><br><span class="line"></span><br><span class="line"># walk in a line until blocked</span><br><span class="line">label start_loop</span><br><span class="line">3</span><br><span class="line">copy 0 6</span><br><span class="line">copy 6 3    # put the input in reg3</span><br><span class="line">start_loop</span><br><span class="line">eval =      # if reg3 is 0 there is no wall</span><br></pre></td></tr></tbody></table></figure>

<p>glhf</p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#tutorial" aria-expanded="false" aria-controls="collapse">
Hide Tutorial
</button>

</div>

<div id="old-cpu-post" class="collapse">

<h2 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h2><p>A while back, I came across an interesting game on Steam called <a target="_blank" rel="noopener" href="https://turingcomplete.game/">Turing Complete</a>. The objective of the game is to design a Turing complete CPU from scratch, and it guides players through each step of the process. Starting with the basics of logic gates, the building blocks of a CPU, players tackle progressively more complex challenges until they reach the point of designing their own CPU capable of performing simple tasks. I found the game captivating and spent an unhealthy amount of time in it.</p>

<center>
<img src="turing_complete.webp" alt="turing_complete" loading="lazy" decoding="async" width="1920" height="1080" srcset="turing_complete.webp 1920w, turing_complete@1620w.webp 1620w, turing_complete@1320w.webp 1320w, turing_complete@1020w.webp 1020w" sizes="100vw">
<p><small>Turing Complete gameplay</small></p>
</center>


<p>After completing the game, I decided it would be fun to create a Python emulator for a similar CPU. While it’s relatively easy to make a basic emulator in Python due to its high-level nature, I chose a different approach. I wanted to build the CPU entirely from scratch, deriving the logic from the fundamental functionality of logic gates. This means that the CPU’s performance is determined solely by simple true/false comparisons, without relying on if statements or other control flows. It does make the code a bit harder to read at times, but by merely changing the function of a single logic gate, you can witness how the entire CPU’s behavior is affected (spoiler alert: it stops working).</p>
<h2 id="Logic-Gates"><a href="#Logic-Gates" class="headerlink" title="Logic Gates"></a>Logic Gates</h2><p>The design starts with the logic gates. Here is an excerpt of the code</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="function_ title">and_</span>(<span class="params">*args:<span class="built_in">bool</span></span>)-&gt;<span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">all</span>(args))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="function_ title">or_</span>(<span class="params">*args:<span class="built_in">bool</span></span>)-&gt;<span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">any</span>(args))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="function_ title">not_</span>(<span class="params">*args:<span class="built_in">bool</span></span>)-&gt;<span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="keyword">not</span> <span class="built_in">all</span>(args))</span><br></pre></td></tr></tbody></table></figure>
<p>The logic gates perform simple comparisons and return true or false values. For example the AND gate returns true only if both of its inputs are true. The OR gate returns true if either (or both) of its inputs are true.</p>

<center>
<img src="logic_gates.webp" alt="logic gates" loading="lazy" decoding="async" width="480" height="300">
<p><small>logic gate symbols</small></p>
</center>


<h2 id="Basic-Components"><a href="#Basic-Components" class="headerlink" title="Basic Components"></a>Basic Components</h2><p>Once we have our logic gates, we can utilize them to create essential components. Let’s focus on the full adder as an example. The purpose of a full adder is to take two binary inputs and perform addition on them. For instance, when adding 0 + 0, the output is 0. When adding 1 + 0, the output is 1.</p>
<p>However, adding 1 + 1 poses a challenge. In binary, we lack a way to represent the number 2 directly. To address this, we introduce a carry bit, similar to carrying over a digit when adding two decimal numbers that exceed 9. Additionally, we have a carry input to account for any carry bits from previous additions. </p>

<center>
<img src="full_adder.webp" alt="full adder" loading="lazy" decoding="async" width="1024" height="473">
<p><small>full adder design</small></p>
</center>



<p>A truth table is a structured table that presents the outputs corresponding to all possible input combinations. It allows us to systematically analyze the behavior of a component or system under consideration. In the case of a full adder, the truth table would display the sum output and carry output for each potential combination of binary inputs and carry input. By checking the truth table, we can see how the full adder operates under different input scenarios.</p>

<center>
<img src="full_adder_truth.webp" alt="full adder truth table" loading="lazy" decoding="async" width="358" height="234">
<p><small>full adder truth table</small></p>
</center>


<p>The above design can now be implemented in code, using the logic gates we have created previously. In this case I first made a half adder (which doesn’t have a carry in) and used two of them to construct a full adder. Notice how all the logic is dependent on the operation of the logic gates.</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="function_ title">half_adder</span>(<span class="params">input1:<span class="built_in">bool</span>, input2:<span class="built_in">bool</span></span>):</span><br><span class="line">    <span class="keyword">return</span> sn(</span><br><span class="line">        <span class="built_in">sum</span>=xor(input1, input2),</span><br><span class="line">        carry=and_(input1, input2)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="function_ title">full_adder</span>(<span class="params">input1:<span class="built_in">bool</span>, input2:<span class="built_in">bool</span>, carry_in:<span class="built_in">bool</span></span>):</span><br><span class="line">    half_adder1 = half_adder(input1, input2)</span><br><span class="line">    half_adder2 = half_adder(half_adder1.<span class="built_in">sum</span>, carry_in)</span><br><span class="line">    out = sn(</span><br><span class="line">        <span class="built_in">sum</span>=half_adder2.<span class="built_in">sum</span>,</span><br><span class="line">        carry=or_(half_adder1.carry, half_adder2.carry)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> out</span><br></pre></td></tr></tbody></table></figure>

<p>After creating a number of basic components such as these, we create more complex components such as an ALU (Arithmetic Logic Unit). The task of the ALU is to perform simple mathematical operations, such as adding 2 numbers together. In this case the ALU can only perform 4 simple operations; Addition, Subtraction, and two logical operations AND and OR. I took inspiration from this 32 bit ALU design, although mine only has 8 bits.</p>

<center>
<img src="ALU.webp" alt="alu" loading="lazy" decoding="async" width="2524" height="1266" srcset="ALU.webp 2524w, ALU@1324w.webp 1324w, ALU@1024w.webp 1024w" sizes="100vw">
<p><small>32 bit ALU design</small></p>
</center>


<h1 id="The-Full-CPU"><a href="#The-Full-CPU" class="headerlink" title="The Full CPU"></a>The Full CPU</h1><p>The design of the CPU includes six registers, an input, and an output, along with an ALU. Additionally, there is a unit that can carry out comparisons between a value and zero. The CPU operates by executing one of four distinct types of operations:</p>
<ul>
<li><p>Immediate: This operation is for moving a given value into register 0. </p>
</li>
<li><p>Arithmetic: The operands for any arithmetic operation are always register 1 and register 2, and the resultant output is stored in register 3.</p>
</li>
<li><p>Copy: This operation is used for duplicating values from one register to another or to the output. For example, ‘copy 0 6’ copies from register 0 to the output, and ‘copy 5 3’ copies from register 5 to register 3.</p>
</li>
<li><p>Evaluation: This operation evaluates the value in register 3 against zero. If the condition is true, it sets the program counter to the value in register 0.</p>
</li>
</ul>

<center>
<img src="full_cpu.webp" alt="full cpu" loading="lazy" decoding="async" width="1490" height="1184" srcset="full_cpu.webp 1490w, full_cpu@1190w.webp 1190w, full_cpu@890w.webp 890w" sizes="100vw">
<p><small>CPU design</small></p>
</center>


<p>Using just these operations we have already created a turing complete CPU! However writing code for it would be challenging as we would have to write everything in binary. To solve this I made a simple assembler that converts assembly code to binary. It also adds a number of useful features such as labels. Labels allow you to mark a point in your program to jump to, making it much easier to create loops in your code. Let’s take a look at a simple program. </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># create a marker at the beginning of the program where we can jump to</span><br><span class="line">label start </span><br><span class="line"></span><br><span class="line"># read from input (reg6) into reg1</span><br><span class="line">copy 6 1</span><br><span class="line"></span><br><span class="line"># add reg 1 and 2, store the result in reg3</span><br><span class="line">add</span><br><span class="line"></span><br><span class="line">#copy result from reg3 into reg2</span><br><span class="line">copy 3 2</span><br><span class="line"></span><br><span class="line"># loop back to start if the value is not negative</span><br><span class="line">start</span><br><span class="line">eval &gt;=</span><br><span class="line"></span><br><span class="line"># Once the value overflows and becomes negative send the result to the output</span><br><span class="line">copy 3 6</span><br></pre></td></tr></tbody></table></figure>

<p>In the simple program above, the value 1 is continuously being fed into the CPU. At each iteration we add it to the value stored in register 2, so that we increment the value by 1. Eventually the value grows large enough that it overflows and becomes negative. This is because in binary the most significant bit (MSB) is used to represent negative numbers. Once this happens the program stops running.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2>
<center>
<img src="norway.webp" alt="NORway" loading="lazy" decoding="async" width="680" height="453">
<p><small>NOR-way</small></p>
</center>


<p>I thought this was quite a fun project, I certainly learnt a lot. While it may seem a little complicated, the truth is that by playing Turing Complete, you learn in a very intuitive manner. I can highly recommend it. If you want to write your own program or take a look at the code, it is all available on my <a target="_blank" rel="noopener" href="https://github.com/BasedLukas/cpu_simulator">github</a>.</p>
<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#old-cpu-post" aria-expanded="false" aria-controls="collapse">
Hide Blog Post
</button>

</div>





                
            </div>

        </div>
    </div>
</article>

    <!-- Footer -->
    <hr>

<!-- Footer -->
<footer>

    <div class="ml-embedded" data-form="EHGAhY"></div>
    <br>
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">

                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://x.com/LukasBogacz" target="_blank">
                                <span class="fa-lg fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-inverse fa-stack-1x fa-twitter"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/BasedLukas" target="_blank">
                                <span class="fa-lg fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-inverse fa-stack-1x fa-github"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="mailto:info@loreley.one" target="_blank">
                                <span class="fa-lg fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-inverse fa-stack-1x fa-envelope-o"></i>
                                </span>
                            </a>
                        </li>
                    
                        <li>
                            <a href="http://loreley.one/atom.xml" target="_blank">
                                <span class="fa-lg fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-inverse fa-stack-1x fa-rss"></i>
                                </span>
                            </a>
                        </li>
                        

                    
                </ul>
                <p class="copyright text-muted">© 2025 Lukas</p>



                
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    

<script defer="" src="/js/analytics.js" data-host="https://api.tinybird.co" data-token="p.eyJ1IjogImYxMGY0NmY5LWI2MTQtNGY3Mi1hNWRkLTJkZWMyZTYzOGU0ZCIsICJpZCI6ICJmM2Y3MDk5Ny03YTZiLTRlYzUtYTdkNC01ZTVkMmY1ZjZjMDcifQ.uBS7CItgVesD7IqUpKSyA_g6UNTH-YHuH3-XfpWy1o0"></script>






</body></html>