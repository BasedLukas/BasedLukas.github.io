<!DOCTYPE html><html lang="en"><!-- Head tag --><head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">



    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- Bootstrap -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <!--Tiny bird analytics-->

    <!-- background image -->
    <link rel="preload" href="/img/bg.webp" as="image" fetchpriority="high">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"> 
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- Gallery -->
    <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/> -->


    <!--Description-->
    

    
        <meta name="description" content="My incoherent ramblings">
        <meta property="og:description" content="My incoherent ramblings">
        <meta name="twitter:description" content="My incoherent ramblings">
    

    <!--Author-->
    
        <meta name="author" content="Lukas">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="WASM">
        <meta name="twitter:title" content="WASM">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Lukas's Blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
        <meta name="twitter:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
    

        <meta name="twitter:card" content="summary_large_image">

    
        <meta name="twitter:site" content="@LukasBogacz">
    

    
        <meta name="twitter:image" content="http://loreley.one/2024-12-wasm/wasm.jpg">
    

    <!-- Title -->
    
    <title>WASM - Lukas's Blog</title>

    <!-- favicon -->
    
        <link rel="icon" href="/img/favicon.ico">
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-custom navbar-default navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Home</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/links">
                            
                                Links
                            
                        </a>
                    </li>
                
                    <li>
                        <a target="_blank" rel="noopener" href="https://github.com/BasedLukas">
                            
                                <i class="fa fa-stack-2x fa-github"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image:url(/img/bg.webp)">
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-1">
                <div class="post-heading">
                    <h1>WASM</h1>
                    
                    <h2 class="post-subheading">
                        It's so over for JavaScript
                    </h2>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Lukas on
                        
                        
                            2024-12-06
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-md-10 col-md-offset-1 col-lg-offset-1 col-lg-10">
                
<iframe src="robot.html" style="border:none;width:100%;height:850px"></iframe>


<p><em>Note: This game is based on a <a href="https://loreley.one/2023-07-cpu/">previous blog post </a> of mine. I’ve been playing around with WASM (Web Assembly) and decided to resuscitate my old python code. The way it works is that the entire python interpreter is bundled with the game in the browser (using pyodide). See my github for the implementation.</em></p>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>This CPU features six general-purpose registers (<code>reg0</code> to <code>reg5</code>), along with a special register (<code>reg6</code>) used for both input and output. It supports four main types of operations:</p>
<ul>
<li><strong>Immediate Values</strong></li>
<li><strong>Arithmetic Operations</strong></li>
<li><strong>Copying</strong></li>
<li><strong>Comparisons and Control Flow</strong></li>
</ul>
<p>All values in the CPU are 8-bit and overflow after 255 to 0.<br>For comparisons, values are treated as <strong>signed</strong> (range -128 to 127).</p>
<hr>
<h3 id="Immediate-Values"><a href="#Immediate-Values" class="headerlink" title="Immediate Values"></a>Immediate Values</h3><p>Load a constant value into <code>reg0</code>. Only values up to 63 are allowed because the two most significant bits (MSB) are reserved for instruction encoding.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">0       # Load 0 into reg0 (min allowed immediate)</span><br><span class="line">36      # Load 36 into reg0</span><br><span class="line">63      # Load 63 into reg0 (max allowed immediate)</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Copying-Data"><a href="#Copying-Data" class="headerlink" title="Copying Data"></a>Copying Data</h3><p>The <code>copy</code> instruction copies data between registers or between a register and the input/output. The syntax is:<br><strong>Input and Output</strong>: <code>reg6</code> serves as both the input and output register.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">copy &lt;source_register&gt; &lt;destination_register&gt;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">copy 6 1   # Copy value from input (reg6) to reg1</span><br><span class="line">copy 3 6   # Copy value from reg3 to output (reg6)</span><br><span class="line">copy 5 3   # Copy value from reg5 into reg3</span><br><span class="line">copy 6 6   # Copy from input directly to output</span><br><span class="line">copy 1 1   # NOP</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Arithmetic-and-Logical-Operations"><a href="#Arithmetic-and-Logical-Operations" class="headerlink" title="Arithmetic and Logical Operations"></a>Arithmetic and Logical Operations</h3><p>Arithmetic and logical operations use <code>reg1</code> and <code>reg2</code> as operands and store the result in <code>reg3</code>. Supported operations:<br>Arithmetic uses 2’s complliment. Values overflow if they exceed 255. </p>
<p><strong>Addition</strong> (<code>add</code>): Adds <code>reg1</code> and <code>reg2</code>.<br><strong>Subtraction</strong> (<code>sub</code>): Subtracts <code>reg2</code> from <code>reg1</code>.<br><strong>Bitwise AND</strong> (<code>and</code>): Performs a bitwise AND operation on <code>reg1</code> and <code>reg2</code>.<br><strong>Bitwise OR</strong> (<code>or</code>): Performs a bitwise OR operation on <code>reg1</code> and <code>reg2</code>.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1        # Load 1 into reg0</span><br><span class="line">copy 0 1 # Move 1 into reg1</span><br><span class="line">2        # Load 2 into reg0</span><br><span class="line">copy 0 2 # Move 2 into reg2</span><br><span class="line">add      # reg3 = reg1 + reg2 = 1 + 2 = 3</span><br><span class="line">copy 3 6 # Output result (3)</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">32</span><br><span class="line">copy 0 1</span><br><span class="line">32</span><br><span class="line">copy 0 2</span><br><span class="line">add  # 64 in reg 3</span><br><span class="line">copy 3 2</span><br><span class="line">copy 3 1</span><br><span class="line">add # 128 in reg 3</span><br><span class="line">copy 3 1</span><br><span class="line">copy 3 2</span><br><span class="line">add </span><br><span class="line">copy 3 6</span><br><span class="line"># total 256, so output is 0 == [0,0,0,0,0,0,0,0]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">0</span><br><span class="line">copy 0 1</span><br><span class="line">2</span><br><span class="line">copy 0 2</span><br><span class="line">sub  # 0 - 2 = -2</span><br><span class="line">copy 3 6</span><br><span class="line"># cpu output is -2 == [1,1,1,1,1,1,1,0]</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">32</span><br><span class="line">copy 0 1</span><br><span class="line">32</span><br><span class="line">copy 0 2</span><br><span class="line">add  # 64 in reg 3</span><br><span class="line">copy 3 2</span><br><span class="line">copy 3 1</span><br><span class="line">add # 128 in reg 3</span><br><span class="line">1</span><br><span class="line">copy 0 2</span><br><span class="line">copy 3 1</span><br><span class="line">sub     # 128 - 1</span><br><span class="line">copy 3 6</span><br><span class="line"># result is 127 == [0,1,1,1,1,1,1,1] in 2's compliment</span><br></pre></td></tr></tbody></table></figure>

<hr>
<h3 id="Comparisons-and-Control-Flow"><a href="#Comparisons-and-Control-Flow" class="headerlink" title="Comparisons and Control Flow"></a>Comparisons and Control Flow</h3><p>The <code>eval</code> instruction compares the <strong>signed</strong> value in <code>reg3</code> against <code>0</code>. If the condition is true, the program counter jumps to the address in <code>reg0</code>.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">eval &lt;condition&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>Supported conditions:</p>
<ul>
<li><code>eval always</code>: Always jump.</li>
<li><code>eval never</code>: Never jump.</li>
<li><code>eval =</code>: Jump if <code>reg3 == 0</code>.</li>
<li><code>eval !=</code>: Jump if <code>reg3 != 0</code>.</li>
<li><code>eval &lt;</code>: Jump if <code>reg3 &lt; 0</code> (signed).</li>
<li><code>eval &lt;=</code>: Jump if <code>reg3 &lt;= 0</code> (signed).</li>
<li><code>eval &gt;</code>: Jump if <code>reg3 &gt; 0</code> (signed).</li>
<li><code>eval &gt;=</code>: Jump if <code>reg3 &gt;= 0</code> (signed).</li>
</ul>
<hr>
<h3 id="Labels"><a href="#Labels" class="headerlink" title="Labels"></a>Labels</h3><p>Labels act as named locations in the program. Defining a label associates it with its position in the program. Calling labels is just shorthand for using immediate values (and thus labels can’t be placed after line 63).</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">label &lt;name&gt;</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">label start # start = 0</span><br><span class="line">copy 6 1    # Read input into reg1</span><br><span class="line">add         # Add reg1 and reg2</span><br><span class="line">start       # Label used here as jump target, equvalent to using immediate 0</span><br><span class="line">eval &gt;=     # Jump to "start" if reg3 &gt;= 0</span><br></pre></td></tr></tbody></table></figure>

<p>This program copies <code>1</code> into <code>reg1</code>, adds it with <code>reg2</code>, and stores the result in <code>reg2</code> in a loop until the result overflows and becomes negative.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">1           # Load 1 into reg0</span><br><span class="line">copy 0 1    # Copy 1 into reg1</span><br><span class="line">label loop</span><br><span class="line">add         # reg3 = reg1 + reg2</span><br><span class="line">copy 3 2    # Store result in reg2</span><br><span class="line">copy 3 6    # print result to output</span><br><span class="line">loop</span><br><span class="line">eval &gt;=     # Jump to label loop if reg3 &gt;= 0</span><br></pre></td></tr></tbody></table></figure>

<p><strong>For comparisons, the value is treated as signed (<code>127</code> is interpreted as <code>127</code>, but <code>128</code> is interpreted as <code>-128</code>). The last result the cpu prints is thus <code>128</code></strong></p>
<h3 id="Robot-Instructions"><a href="#Robot-Instructions" class="headerlink" title="Robot Instructions"></a>Robot Instructions</h3><p>output (controls):<br><code>1 == turn left</code><br><code>2 == turn right</code><br><code>3 == step forward</code></p>
<p>input:<br><code>1 == wall</code><br><code>0 == clear</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"># this will rotate you left</span><br><span class="line">1</span><br><span class="line">copy 0 6</span><br><span class="line"></span><br><span class="line"># rotate right 3 times</span><br><span class="line">2</span><br><span class="line">copy 0 6</span><br><span class="line">copy 0 6</span><br><span class="line">copy 0 6</span><br><span class="line"></span><br><span class="line"># walk in a line until blocked</span><br><span class="line">label start_loop</span><br><span class="line">3</span><br><span class="line">copy 0 6</span><br><span class="line">copy 6 3    # put the input in reg3</span><br><span class="line">start_loop</span><br><span class="line">eval =      # if reg3 is 0 there is no wall</span><br></pre></td></tr></tbody></table></figure>

<p>glhf</p>


                
            </div>

        </div>
    </div>
</article>

    <!-- Footer -->
    <hr>

<!-- Footer -->
<footer>
<!-- MailerLite Universal -->
<script>(function(e,s,a,m,t,n,c){e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},n=s.createElement(a),n.async=1,n.src=m,c=s.getElementsByTagName(a)[0],c.parentNode.insertBefore(n,c)})(window,document,"script","/js/mailerlite.js","ml"),ml("account","1166122");
</script>
<!-- End MailerLite Universal -->
    <div class="ml-embedded" data-form="EHGAhY"></div>
    <br>
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">

                <ul class="list-inline text-center">
                    

                    

                    

                    

                    
                        <li>
                            <a href="mailto:info@loreley.one" target="_blank">
                                <span class="fa-lg fa-stack">
                                    <i class="fa fa-stack-2x fa-circle"></i>
                                    <i class="fa fa-envelope-o fa-inverse fa-stack-1x"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                </ul>
                <p class="copyright text-muted">© 2024 Lukas</p>



                
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    

<script defer="" src="/js/analytics.js" data-host="https://api.tinybird.co" data-token="p.eyJ1IjogImYxMGY0NmY5LWI2MTQtNGY3Mi1hNWRkLTJkZWMyZTYzOGU0ZCIsICJpZCI6ICJmM2Y3MDk5Ny03YTZiLTRlYzUtYTdkNC01ZTVkMmY1ZjZjMDcifQ.uBS7CItgVesD7IqUpKSyA_g6UNTH-YHuH3-XfpWy1o0"></script>






</body></html>